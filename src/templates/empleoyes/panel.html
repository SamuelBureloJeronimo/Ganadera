{% extends 'dashboard.html' %}

{% block sidenavbar %}
<li class="mb-4"><a href="/dashboard/owner/panel" class="bg-blue-500 block p-2 rounded hover:bg-blue-500">INICIO</a></li>
<!-- Reportes con Submenú -->
<li class="mb-4">
    <button onclick="toggleSubmenu('acti')" class="w-full text-left p-2 rounded hover:bg-blue-500 flex justify-between items-center">
        Gestión de actividades
        <span id="icon-gn" class="transition-transform">▼</span>
    </button>
    <ul id="gn" class="ml-4 hidden">
        <li><a href="/dashboard/owner/register-ganado" class="block p-2 rounded hover:bg-gray-700">Ver actividades</a></li>
    </ul>
</li>
<!-- Reportes con Submenú -->
<li class="mb-4">
    <button onclick="toggleSubmenu('asis')" class="w-full text-left p-2 rounded hover:bg-blue-500 flex justify-between items-center">
        Mis asistencias
        <span id="icon-emp" class="transition-transform">▼</span>
    </button>
    <ul id="emp" class="ml-4 hidden">
        <li><a href="/dashboard/owner/register-employee" class="block p-2 rounded hover:bg-gray-700">Visualizar</a></li>

    </ul>
</li>
{% endblock %}


{% block headDash %}
<!-- Barra Superior -->
<header class="bg-[#261c16] text-white shadow p-4 flex items-center">
    <!-- Botón para abrir/cerrar sidebar en móviles -->
    <button id="toggleSidebar" class="md:hidden text-2xl">
        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e8eaed"><path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/></svg>
    </button>
    <h1 class="text-xl font-semibold" style="margin-left: 5vh;"> {% block title_bar %} Bienvenido {% endblock %}</h1>
</header>      
{% endblock %}  

{% block cont_dash %}
<div style="margin-top: 3vh; margin-bottom: 3vh;">
    <label>Registrar asistencias</label>
    <hr>
  </div>

  <div class="container mt-5">
    <h2>Bienvenido, {{ session['correo'] }}</h2>
    <p>Puesto: {{ session['puesto_nombre'] }}</p>
    <p>Horario: {{ session['h_entrada'] }} - {{ session['h_salida'] }}</p>
    
    <button id="btnEntrada" class="btn btn-success" disabled onclick="registrarAsistencia('entrada')">Registrar Entrada</button>
    <button id="btnSalida" class="btn btn-danger" disabled onclick="registrarAsistencia('salida')">Registrar Salida</button>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        let hEntrada = "{{ session['h_entrada'] }}";
        let hSalida = "{{ session['h_salida'] }}";
        let ahora = new Date();
        let horaActual = ahora.getHours() + ":" + ahora.getMinutes();
        
        let entradaActivaDesde = new Date();
        entradaActivaDesde.setHours(hEntrada.split(":")[0] - 1, hEntrada.split(":")[1]);

        let entradaActivaHasta = new Date();
        entradaActivaHasta.setHours(hEntrada.split(":")[0], parseInt(hEntrada.split(":")[1]) + 16);
        
        let salidaActivaDesde = new Date();
        salidaActivaDesde.setHours(hSalida.split(":")[0], parseInt(hSalida.split(":")[1]) - 5);
        
        if (ahora >= entradaActivaDesde && ahora <= entradaActivaHasta) {
            document.getElementById("btnEntrada").disabled = false;
        }
        
        if (ahora >= salidaActivaDesde) {
            document.getElementById("btnSalida").disabled = false;
        }
    });

    function registrarAsistencia(tipo) {
        fetch("/registrar_asistencia", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ tipo: tipo })
        }).then(response => response.json())
          .then(data => alert(data.message));
    }
</script>

<script>
    function redirect(ruta) {
        window.location.href = ruta;
    }
</script>
{% endblock %}
